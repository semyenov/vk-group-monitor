<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VK Group Monitor Posts</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans p-5">
    <h1 class="text-center text-2xl font-bold text-gray-800 mb-6 drop-shadow-md">VK Group Monitor</h1>
    <div id="posts" class="max-w-3xl mx-auto"></div>

    <script>
      async function fetchPosts() {
        const postsResponse = await fetch("/api/posts");
        const posts = await postsResponse.json();
        const postsDiv = document.getElementById("posts");

        const groupStatesResponse = await fetch("/api/groups");
        const groups = await groupStatesResponse.json();

        function getGroupState(groupId) {
          return groups.data.find((state) => state.id === groupId);
        }

        if (posts.success) {
          posts.data.forEach((post) => {
            const postDiv = document.createElement("div");
            postDiv.className = "bg-white border border-gray-300 rounded-lg mb-4 shadow relative";
            postDiv.innerHTML = `
              <h2 class="text-blue-600 mb-2 py-2 px-4 relative z-10 w-full border-b border-gray-300 flex items-center justify-between">
                <div class="flex flex-row items-center">
                  <img
                    src="${groups.success ? getGroupState(post.groupId).photo_50 : ""}"
                    class="relative h-10 inline-flex py-2 mr-2 rounded-full"
                  />
                  <span class="text-lg font-bold">${groups.success ? getGroupState(post.groupId).name : post.groupId}</span>
                </div>
                <div class="ml-2 px-2 py-1 rounded-full float-right text-xs text-gray-500 bg-white bg-opacity-80">
                  ${new Date(post.date * 1000).toLocaleString()}
                </div>
              </h2>
              <p class="mb-2 bg-white bg-opacity-80 text-gray-700 py-1 px-4 rounded-md leading-tight">
                ${post.rewritten}
              </p>
              <p class="mt-4 py-4 border-t border-dashed border-gray-300 italic text-xs text-gray-500 bg-white bg-opacity-80 py-1 px-4 rounded-md">
                <b class="text-gray-700">Оригинал:</b>
                ${post.original}
              </p>`;

            postsDiv.appendChild(postDiv);
          });
        } else {
          postsDiv.innerHTML = `<p class="text-red-600 text-center">Error fetching posts: ${posts.error}</p>`;
        }
      }

      fetchPosts();
    </script>
  </body>
</html>
